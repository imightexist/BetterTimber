<!DOCTYPE html>
<html>

<head>
    <!-- Website Sources -->
    <title>BetterTimber</title>
    <!-- Website Themes and CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <style>
        body {
            background-image: url(wallpaper.png);
            background-size: cover;
        }

        /* width */

        ::-webkit-scrollbar {
            width: 15px;
        }

        /* Handle */

        ::-webkit-scrollbar-thumb {
            background: rgb(187, 187, 187);
        }

        /* Handle on hover */

        ::-webkit-scrollbar-thumb:hover {
            background: rgb(122, 122, 122);
        }


        body {
            font-family: "Segoe UI", sans-serif;
        }

        #message {
            width: 100%;
            height: 100%;
            padding-top: 50%;
            padding-bottom: 50%;
            text-align: center;
            background-color: white;
            border-color: black;
            padding: 15px;
            border: 1.5px solid black;
            border-radius: 4px;
            font-size: 26px;
            margin: 5px;
        }

        .help-button {
            position: absolute;
            top: 50.25%;
            left: -10.50%;
            padding-left: 95%;
            z-index: 2;
        }

        .navbar-default-modded {
            background-image: linear-gradient(Orgb(255, 255, 255) Opx, rgb(248, 248, 248) 100%);
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            box-shadow: rgba(255,
                    255, 255, 0.15) 0px 1px 0px inset, rgba(0, 0, 0, 0.075) 0px 1px 5px;
            -webkit-box-shadow: rgba(255, 255. 255. 0.15) 0px 1px 0px inset, rgba(0, 0, 0, 0.075) 0px 1px 5px;
            background-color: rgba(0, 0, 0, 0.15);
            border-bottom-color: rgb(231, 231, 231);
            border-left-color: rgb(231, 231, 231);
            border-right-color: rgb(231, 231, 231);
            border-top-color: rgb(231, 231, 231);
            z-index: 2;
            bottom: 100;
            right: 0;
        }

        @media screen and (max-width: 480px) {
            .hideonmobile {
                display: none !important;
            }
        }

        @media screen and (min-width: 481px) and (max-width: 800px) {
            .hideontablet {
                display: none !important;
            }
        }

        @media screen and (min-width: 801px) {
            .hideondesktop {
                display: none !important;
            }
        }

        .banner {
            width: 100%;
            height: 100%;
            border-bottom-color: black;
            border-bottom: 1px solid black;
            border-radius: 4px;
        }

        .blur {
            filter: blur(16px);
        }

        .iframe {
            width: 100%;
            max-width: 100%;
            height: 50%;
            max-height: 50%;
        }

        .dropbtn {
            background-color: #04AA6D;
            color: white;
            padding: 16px;
            font-size: 16px;
        }

        .welcome {
            box-shadow: inset 0 1px 0 rgb(255 255 255 / 25%), 0 1px 2px rgb(0 0 0 / 5%);
            text-shadow: 0 1px 0 rgb(255 255 255 / 20%);
            background-color: #b1dd8b;
            border-color: #669d34;
            padding: 15px;
            border: 2px solid #669d34;
            border-radius: 4px;
            font-size: 110%
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        div.option-1 {
            position: absolute;
            left: 25%;
        }

        div.option-2 {
            position: absolute;
            left: 50%;
        }

        div.file-container {
            border-color: #000000;
            border-style: cursive;
            padding: 10px;
            border: 1px solid;
            border-radius: 10px;
            margin: 5px;
            background-color: Field;
        }

        div #margin {
            margin: 10px;
        }

        .site-view-1 {
            display: yes;
        }

        .site-view-2 {
            display: yes;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #1e1e1e;
            min-width: 160px;
            z-index: 1;
        }

        .dropdown-content a {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #333333;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown:hover .dropbtn {
            background-color: #3e8e41;
        }
        .navbar-nav{
            font-size:40px;
            color:white
        }
    </style>
    <script>
        function decodeCommand(cypher) {
            var sections = [];
            var bump = 0;
            while (sections.length <= 50 && cypher.length >= bump) {
                var current = cypher.substring(bump);
                var length = parseInt(current.substring(current.search(/\./) - 2));
                var paramater = current.substring(length.toString().length + 1, Math.floor(length / 10) + 2 + length);
                sections[sections.length] = paramater;
                bump += Math.floor(length / 10) + 3 + length;
            }
            sections[sections.length - 1] = sections[sections.length - 1].substring(0, sections[sections.length - 1].length - 1);
            return sections;
        }
        function encodeCommand(cypher) {
            var command = "";
            for (var i = 0; i < cypher.length; i++) {
                var current = cypher[i];
                command += current.length + "." + current;
                command += (i < cypher.length - 1 ? "," : ";");
            }
            return command;
        }
        function rename(){
            username = prompt("New username");
            socket.send(encodeCommand(['rename',username]));
            document.getElementById('title').innerHTML = "BetterTimber | VM: " + params.get('name') + " | Username: " + username;
        }
        function admin(){
            pass = prompt("Admin password");
            socket.send(encodeCommand(['admin','2',pass]));
        }
        function taketurn(){
            document.getElementById('status').innerHTML = "Turn time left: ";
            document.getElementById('endturn').style.removeProperty('display');
            document.getElementById('taketurn').style.display = "none";
            socket.send(encodeCommand(['turn']));
        }
        function endturn(){
            document.getElementById('status').innerHTML = "No turn";
            document.getElementById('endturn').style.display = "none";
            document.getElementById('taketurn').style.removeProperty('display');
            socket.send(encodeCommand(['turn','0']));
        }
        window.onload = function(){
            //bruh
            params = new URLSearchParams(window.location.search);
            username = "guest" + (Math.floor(Math.random() * 98999) + 10).toString();
            document.getElementById('title').innerHTML = "BetterTimber | VM: " + params.get('name') + " | Username: " + username;
            canvas = document.getElementById('screen');
            socket = new WebSocket("ws://" + params.get('vm'),['guacamole']);
            socket.onopen = function(){
                socket.send(encodeCommand(['connect',params.get('name')]));
                socket.send(encodeCommand(['rename',username]));
                setInterval(function(){
                    socket.send(encodeCommand(['nop']));
                },2500);
            }
        }
    </script>
</head>

<body>
    <nav class="navbar navbar-default-modded navbar-static-top">
        <center>
            <div class="container-fluid">
                <ul class="nav navbar-nav">
                    <center id="title">BetterTimber</center>
                </ul>
            </div>
        </center>
    </nav>
    
    <center>
        <div class="container">
            <h6 id="status" style="color:white;font-size:34px">No turn</h6>
            <img id="screen">
            <button id="taketurn" onclick="taketurn()">Take Turn</button>
            <button id="endturn" onclick="endturn()" style="display:none">End Turn</button>
            <button id="rename" onclick="rename()">Rename</button>
            <button id="admin" onclick="admin()">Admin</button>
        </div>
    </center>
    
</body>

</html>